{"version":3,"sources":["application.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","finalhandler","Router","methods","middleware","query","dbg","View","http","compileETag","compileQueryParser","compileTrust","flatten","merge","resolve","EventEmitter","debug","slice","Application","_super","apply","arguments","init","cache","engines","settings","defaultConfiguration","env","process","NODE_ENV","enable","$","defineProperty","trustProxyDefaultSymbol","configurable","value","on","onmount","parent","request","response","locals","mountPath","lazyRouter","router","caseSensitive","enabled","strict","use","handle","req","res","callback","done","onerror","logError","bind","route","path","engine","ext","fn","Error","extension","param","arg0","arg1","isArray","i","length","setting","Boolean","disabled","disable","all","args","_i","render","name","options","renderOptions","opts","view","_locals","View_1","defaultEngine","root","dirs","join","err","tryRender","listen","server","createServer","offset","arg","fns","forEach","mounted_app","next","orig","app","emit","method","console","error","stack","toString"],"mappings":"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","file":"application.js","sourcesContent":["var __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        if (typeof b !== \"function\" && b !== null)\r\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nimport finalhandler from \"finalhandler\";\r\nimport Router from \"./router\";\r\nimport methods from \"./methods\";\r\nimport * as middleware from \"./middleware/init\";\r\nimport query from \"./middleware/query\";\r\nimport dbg from \"debug\";\r\nimport View from \"./view\";\r\nimport http from \"http\";\r\nimport { compileETag } from \"./utils\";\r\nimport { compileQueryParser } from \"./utils\";\r\nimport { compileTrust } from \"./utils\";\r\nimport { flatten } from \"array-flatten\";\r\nimport merge from \"utils-merge\";\r\nimport { resolve } from \"path\";\r\nimport setPrototypeOf from \"setprototypeof\";\r\nimport { EventEmitter } from \"stream\";\r\nvar debug = dbg(\"oven/ws:application\");\r\nvar slice = Array.prototype.slice;\r\nvar Application = /** @class */ (function (_super) {\r\n    __extends(Application, _super);\r\n    function Application() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    Application.prototype.init = function () {\r\n        this.cache = {};\r\n        this.engines = {};\r\n        this.settings = {};\r\n        this.defaultConfiguration();\r\n    };\r\n    Application.prototype.defaultConfiguration = function () {\r\n        var env = process.env.NODE_ENV || \"development\";\r\n        // default settings\r\n        this.enable(\"x-powered-by\");\r\n        this.$(\"etag\", \"weak\");\r\n        this.$(\"env\", env);\r\n        this.$(\"query parser\", \"extended\");\r\n        this.$(\"subdomain offset\", 2);\r\n        this.$(\"trust proxy\", false);\r\n        // trust proxy inherit back-compat\r\n        Object.defineProperty(this.settings, trustProxyDefaultSymbol, {\r\n            configurable: true,\r\n            value: true,\r\n        });\r\n        debug(\"booting in %s mode\", env);\r\n        this.on(\"mount\", function onmount(parent) {\r\n            // inherit trust proxy\r\n            if (this.settings[trustProxyDefaultSymbol] === true && typeof parent.settings[\"trust proxy fn\"] === \"function\") {\r\n                delete this.settings[\"trust proxy\"];\r\n                delete this.settings[\"trust proxy fn\"];\r\n            }\r\n            // inherit protos\r\n            setPrototypeOf(this.request, parent.request);\r\n            setPrototypeOf(this.response, parent.response);\r\n            setPrototypeOf(this.engines, parent.engines);\r\n            setPrototypeOf(this.settings, parent.settings);\r\n        });\r\n        // setup locals\r\n        this.locals = Object.create(null);\r\n        // default locals\r\n        this.locals.settings = this.settings;\r\n        // top-most app is mounted at /\r\n        this.mountPath = \"/\";\r\n        // default configuration\r\n        this.$(\"view\", View);\r\n        this.$(\"views\", resolve(\"views\"));\r\n        this.$(\"jsonp callback name\", \"callback\");\r\n        if (env === \"production\") {\r\n            this.enable(\"view cache\");\r\n        }\r\n    };\r\n    Application.prototype.lazyRouter = function () {\r\n        if (!this.router) {\r\n            this.router = new Router({\r\n                caseSensitive: this.enabled(\"case sensitive routing\"),\r\n                strict: this.enabled(\"strict routing\"),\r\n            });\r\n            this.router.use(query(this.$(\"query parser fn\")));\r\n            this.router.use(middleware.init(this));\r\n        }\r\n    };\r\n    Application.prototype.handle = function (req, res, callback) {\r\n        var router = this.router;\r\n        // final handler\r\n        var done = callback ||\r\n            finalhandler(req, res, {\r\n                env: this.$(\"env\"),\r\n                onerror: logError.bind(this),\r\n            });\r\n        // no routes\r\n        if (!router) {\r\n            debug(\"no routes defined on app\");\r\n            done();\r\n            return;\r\n        }\r\n        router.handle(req, res, done);\r\n    };\r\n    Application.prototype.route = function (path) {\r\n        this.lazyRouter();\r\n        return this.router.route(path);\r\n    };\r\n    Application.prototype.engine = function (ext, fn) {\r\n        if (typeof fn !== \"function\") {\r\n            throw new Error(\"callback function required\");\r\n        }\r\n        // get file extension\r\n        var extension = ext[0] !== \".\" ? \".\" + ext : ext;\r\n        // store engine\r\n        this.engines[extension] = fn;\r\n        return this;\r\n    };\r\n    Application.prototype.param = function (arg0, arg1) {\r\n        this.lazyRouter();\r\n        if (Array.isArray(arg0)) {\r\n            for (var i = 0; i < arg0.length; i++) {\r\n                this.param(arg0[i], arg1);\r\n            }\r\n            return this;\r\n        }\r\n        this.router.param(arg0, arg1);\r\n        return this;\r\n    };\r\n    Application.prototype.$ = function (setting, value) {\r\n        if (arguments.length == 2) {\r\n            debug('set \"%s\" to %o', setting, value);\r\n            // set value\r\n            this.settings[setting] = value;\r\n            // trigger matched settings\r\n            switch (setting) {\r\n                case \"etag\":\r\n                    this.$(\"etag fn\", compileETag(value));\r\n                    break;\r\n                case \"query parser\":\r\n                    this.$(\"query parser fn\", compileQueryParser(value));\r\n                    break;\r\n                case \"trust proxy\":\r\n                    this.$(\"trust proxy fn\", compileTrust(value));\r\n                    // trust proxy inherit back-compat\r\n                    Object.defineProperty(this.settings, trustProxyDefaultSymbol, {\r\n                        configurable: true,\r\n                        value: false,\r\n                    });\r\n                    break;\r\n            }\r\n            return this;\r\n        }\r\n        return this.settings[setting];\r\n    };\r\n    Application.prototype.path = function () {\r\n        return this.parent ? this.parent.path() + this.mountPath : \"\";\r\n    };\r\n    Application.prototype.enabled = function (setting) {\r\n        return Boolean(this.$(setting));\r\n    };\r\n    Application.prototype.disabled = function (setting) {\r\n        return !this.$(setting);\r\n    };\r\n    Application.prototype.enable = function (setting) {\r\n        return this.$(setting, true);\r\n    };\r\n    Application.prototype.disable = function (setting) {\r\n        return this.$(setting, false);\r\n    };\r\n    Application.prototype.all = function (path) {\r\n        var args = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            args[_i - 1] = arguments[_i];\r\n        }\r\n        this.lazyRouter();\r\n        var route = this.router.route(path);\r\n        for (var i = 0; i < methods.length; i++) {\r\n            route[methods[i]].apply(route, args);\r\n        }\r\n        return this;\r\n    };\r\n    Application.prototype.render = function (name, options, callback) {\r\n        var cache = this.cache;\r\n        var engines = this.engines;\r\n        var renderOptions = {};\r\n        var opts;\r\n        var done;\r\n        var view;\r\n        // support callback function as second arg\r\n        if (typeof options === \"function\") {\r\n            done = options;\r\n            opts = {};\r\n        }\r\n        else {\r\n            done = callback;\r\n            opts = options;\r\n        }\r\n        // merge app.locals\r\n        merge(renderOptions, this.locals);\r\n        // merge options._locals\r\n        if (opts._locals) {\r\n            merge(renderOptions, opts._locals);\r\n        }\r\n        // merge options\r\n        merge(renderOptions, opts);\r\n        // set .cache unless explicitly provided\r\n        if (renderOptions.cache == null) {\r\n            renderOptions.cache = this.enabled(\"view cache\");\r\n        }\r\n        // primed cache\r\n        if (renderOptions.cache) {\r\n            view = cache[name];\r\n        }\r\n        // view\r\n        if (!view) {\r\n            var View_1 = this.$(\"view\");\r\n            view = new View_1(name, {\r\n                defaultEngine: this.$(\"view engine\"),\r\n                root: this.$(\"views\"),\r\n                engines: engines,\r\n            });\r\n            if (!view.path) {\r\n                var dirs = Array.isArray(view.root) && view.root.length > 1\r\n                    ? 'directories \"' + view.root.slice(0, -1).join('\", \"') + '\" or \"' + view.root[view.root.length - 1] + '\"'\r\n                    : 'directory \"' + view.root + '\"';\r\n                var err = new Error('Failed to lookup view \"' + name + '\" in views ' + dirs);\r\n                err.view = view;\r\n                return done(err);\r\n            }\r\n            // prime the cache\r\n            if (renderOptions.cache) {\r\n                cache[name] = view;\r\n            }\r\n        }\r\n        // render\r\n        tryRender(view, renderOptions, done);\r\n    };\r\n    Application.prototype.listen = function () {\r\n        var server = http.createServer(this.handle);\r\n        return server.listen.apply(server, arguments);\r\n    };\r\n    return Application;\r\n}(EventEmitter));\r\nexport default Application;\r\nApplication.prototype.use = function (fn) {\r\n    var offset = 0;\r\n    var path = \"/\";\r\n    // default path to '/'\r\n    // disambiguate app.use([fn])\r\n    if (typeof fn !== \"function\") {\r\n        var arg = fn;\r\n        while (Array.isArray(arg) && arg.length !== 0) {\r\n            arg = arg[0];\r\n        }\r\n        // first arg is the path\r\n        if (typeof arg !== \"function\") {\r\n            offset = 1;\r\n            path = fn;\r\n        }\r\n    }\r\n    var fns = flatten(slice.call(arguments, offset));\r\n    if (fns.length === 0) {\r\n        throw new TypeError(\"app.use() requires a middleware function\");\r\n    }\r\n    // setup router\r\n    this.lazyRouter();\r\n    var router = this.router;\r\n    fns.forEach(function (fn) {\r\n        // non-ws app\r\n        if (!fn || !fn.handle || !fn.$) {\r\n            return router.use(path, fn);\r\n        }\r\n        debug(\".use app under %s\", path);\r\n        fn.mountPath = path;\r\n        fn.parent = this;\r\n        // restore .app property on req and res\r\n        router.use(path, function mounted_app(req, res, next) {\r\n            var orig = req.app;\r\n            fn.handle(req, res, function (err) {\r\n                setPrototypeOf(req, orig.request);\r\n                setPrototypeOf(res, orig.response);\r\n                next(err);\r\n            });\r\n        });\r\n        // mounted an app\r\n        fn.emit(\"mount\", this);\r\n    }, this);\r\n    return this;\r\n};\r\nvar trustProxyDefaultSymbol = \"@@symbol:trust_proxy_default\";\r\nmethods.forEach(function (method) {\r\n    Application.prototype[method] = function (path) {\r\n        this.lazyRouter();\r\n        var route = this.router.route(path);\r\n        route[method].apply(route, slice.call(arguments, 1));\r\n        return this;\r\n    };\r\n});\r\n/**\r\n * Log error using console.error.\r\n *\r\n * @param {Error} err\r\n * @private\r\n */\r\nfunction logError(err) {\r\n    /* istanbul ignore next */\r\n    if (this.$(\"env\") !== \"test\") {\r\n        console.error(err.stack || err.toString());\r\n    }\r\n}\r\n/**\r\n * Try rendering a view.\r\n * @private\r\n */\r\nfunction tryRender(view, options, callback) {\r\n    try {\r\n        view.render(options, callback);\r\n    }\r\n    catch (err) {\r\n        callback(err);\r\n    }\r\n}\r\n//# sourceMappingURL=application.js.map"]}