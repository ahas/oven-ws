{"version":3,"sources":["text.js"],"names":["bytes","contentType","dbg","read","typeis","typeChecker","debug","text","options","opts","defaultCharset","inflate","limit","parse","type","verify","TypeError","shouldParse","buf","textParser","req","res","next","bodyParsed","body","hasBody","headers","charset","getCharset","encoding","parameters","toLowerCase","e","undefined"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,WAAP,MAAwB,cAAxB;AACA,OAAOC,GAAP,MAAgB,OAAhB;AACA,OAAOC,IAAP,MAAiB,SAAjB;AACA,OAAOC,MAAP,MAAmB,SAAnB;AACA,SAASC,WAAT,QAA4B,WAA5B;AACA,IAAIC,QAAQJ,IAAI,kBAAJ,CAAZ;AACA;;;;;;;AAOA,eAAe,SAASK,IAAT,CAAcC,OAAd,EAAuB;AAClC,QAAIC,OAAOD,WAAW,EAAtB;AACA,QAAIE,iBAAiBD,KAAKC,cAAL,IAAuB,OAA5C;AACA,QAAIC,UAAUF,KAAKE,OAAL,KAAiB,KAA/B;AACA,QAAIC,QAAQ,OAAOH,KAAKG,KAAZ,KAAsB,QAAtB,GAAiCZ,MAAMa,KAAN,CAAYJ,KAAKG,KAAL,IAAc,OAA1B,CAAjC,GAAsEH,KAAKG,KAAvF;AACA,QAAIE,OAAOL,KAAKK,IAAL,IAAa,YAAxB;AACA,QAAIC,SAASN,KAAKM,MAAL,IAAe,KAA5B;AACA,QAAIA,WAAW,KAAX,IAAoB,OAAOA,MAAP,KAAkB,UAA1C,EAAsD;AAClD,cAAM,IAAIC,SAAJ,CAAc,gCAAd,CAAN;AACH;AACD;AACA,QAAIC,cAAc,OAAOH,IAAP,KAAgB,UAAhB,GAA6BT,YAAYS,IAAZ,CAA7B,GAAiDA,IAAnE;AACA,aAASD,KAAT,CAAeK,GAAf,EAAoB;AAChB,eAAOA,GAAP;AACH;AACD,WAAO,SAASC,UAAT,CAAoBC,GAApB,EAAyBC,GAAzB,EAA8BC,IAA9B,EAAoC;AACvC,YAAIF,IAAIG,UAAR,EAAoB;AAChBjB,kBAAM,qBAAN;AACAgB;AACA;AACH;AACDF,YAAII,IAAJ,GAAWJ,IAAII,IAAJ,IAAY,EAAvB;AACA;AACA,YAAI,CAACpB,OAAOqB,OAAP,CAAeL,GAAf,CAAL,EAA0B;AACtBd,kBAAM,iBAAN;AACAgB;AACA;AACH;AACDhB,cAAM,iBAAN,EAAyBc,IAAIM,OAAJ,CAAY,cAAZ,CAAzB;AACA;AACA,YAAI,CAACT,YAAYG,GAAZ,CAAL,EAAuB;AACnBd,kBAAM,cAAN;AACAgB;AACA;AACH;AACD;AACA,YAAIK,UAAUC,WAAWR,GAAX,KAAmBV,cAAjC;AACA;AACAP,aAAKiB,GAAL,EAAUC,GAAV,EAAeC,IAAf,EAAqBT,KAArB,EAA4BP,KAA5B,EAAmC;AAC/BuB,sBAAUF,OADqB;AAE/BhB,qBAASA,OAFsB;AAG/BC,mBAAOA,KAHwB;AAI/BG,oBAAQA;AAJuB,SAAnC;AAMH,KA7BD;AA8BH;AACD;;;;;;AAMA,SAASa,UAAT,CAAoBR,GAApB,EAAyB;AACrB,QAAI;AACA,eAAO,CAACnB,YAAYY,KAAZ,CAAkBO,GAAlB,EAAuBU,UAAvB,CAAkCH,OAAlC,IAA6C,EAA9C,EAAkDI,WAAlD,EAAP;AACH,KAFD,CAGA,OAAOC,CAAP,EAAU;AACN,eAAOC,SAAP;AACH;AACJ;AACD","file":"text.js","sourcesContent":["import bytes from \"bytes\";\r\nimport contentType from \"content-type\";\r\nimport dbg from \"debug\";\r\nimport read from \"../read\";\r\nimport typeis from \"type-is\";\r\nimport { typeChecker } from \"src/utils\";\r\nvar debug = dbg(\"body-parser:text\");\r\n/**\r\n * Create a middleware to parse text bodies.\r\n *\r\n * @param {object} [options]\r\n * @return {function}\r\n * @api public\r\n */\r\nexport default function text(options) {\r\n    var opts = options || {};\r\n    var defaultCharset = opts.defaultCharset || \"utf-8\";\r\n    var inflate = opts.inflate !== false;\r\n    var limit = typeof opts.limit !== \"number\" ? bytes.parse(opts.limit || \"100kb\") : opts.limit;\r\n    var type = opts.type || \"text/plain\";\r\n    var verify = opts.verify || false;\r\n    if (verify !== false && typeof verify !== \"function\") {\r\n        throw new TypeError(\"option verify must be function\");\r\n    }\r\n    // create the appropriate type checking function\r\n    var shouldParse = typeof type !== \"function\" ? typeChecker(type) : type;\r\n    function parse(buf) {\r\n        return buf;\r\n    }\r\n    return function textParser(req, res, next) {\r\n        if (req.bodyParsed) {\r\n            debug(\"body already parsed\");\r\n            next();\r\n            return;\r\n        }\r\n        req.body = req.body || {};\r\n        // skip requests without bodies\r\n        if (!typeis.hasBody(req)) {\r\n            debug(\"skip empty body\");\r\n            next();\r\n            return;\r\n        }\r\n        debug(\"content-type %j\", req.headers[\"content-type\"]);\r\n        // determine if request should be parsed\r\n        if (!shouldParse(req)) {\r\n            debug(\"skip parsing\");\r\n            next();\r\n            return;\r\n        }\r\n        // get charset\r\n        var charset = getCharset(req) || defaultCharset;\r\n        // read\r\n        read(req, res, next, parse, debug, {\r\n            encoding: charset,\r\n            inflate: inflate,\r\n            limit: limit,\r\n            verify: verify,\r\n        });\r\n    };\r\n}\r\n/**\r\n * Get the charset of a request.\r\n *\r\n * @param {object} req\r\n * @api private\r\n */\r\nfunction getCharset(req) {\r\n    try {\r\n        return (contentType.parse(req).parameters.charset || \"\").toLowerCase();\r\n    }\r\n    catch (e) {\r\n        return undefined;\r\n    }\r\n}\r\n//# sourceMappingURL=text.js.map"]}